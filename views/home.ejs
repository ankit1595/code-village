<h1><%= title %> | CodeVillage</h1>

<section id="feed-posts">
  <h4>Posts</h4>
  <% if(locals.user) {%>
  <form action="/posts/create" id="new-post-form" method="post">
    <textarea
      name="content"
      cols="30"
      rows="5"
      placeholder="What's on your mind?"
      required
    ></textarea>
    <input type="submit" value="Post" />
  </form>

  <%}%>
  <div id="posts-list-container">
    <ul>
      <% for(post of posts) {%>
      <li>
        <p>
          <% if (locals.user && (post.user.id == locals.user.id)) {%>
          <a href="/posts/destroy/<%= post.id %>"> <strong>x</strong></a>
          <%} %> <%=post.content %> <br />
          <small>
            <% if(post.user) {%> <%= post.user.name %> <%}else{%> anonymous
            <%}%>
          </small>
        </p>
        <div class="post-comments">
          <h5>Comments</h5>
          <% if(locals.user) {%>
          <form action="/comments/create" method="post">
            <input
              type="text"
              name="content"
              placeholder="Type comment here..."
              required
            />
            <input type="hidden" name="post" value="<%= post._id%>" />
            <input type="submit" value="Add Comment" />
          </form>
          <%}%>

          <div class="post-comments-list">
            <ul class="post-comment-<%= post._id%>">
              <% for(comment of post.comments) {%>
              <li>
                <p>
                  <% if(locals.user && comment.user.id == locals.user.id) {%>
                  <a href="/comments/destroy/<%= comment.id %>"
                    ><strong>x</strong></a
                  >
                  <% } %> <%= comment.content %>
                  <br />
                  <small> <%= comment.user.name %> </small>
                </p>
              </li>

              <%} %>
            </ul>
          </div>
        </div>
      </li>

      <%} %>
    </ul>
  </div>
</section>
